<!doctype html>
<html>
  <head>
    <title>Poll Results</title>
  </head>
  <body>
    <h1>Poll Results</h1>
    <div id="results"></div>

    <script>
      const pollId = 1;
      const resultsDiv = document.getElementById("results");
      const eventSource = new EventSource(
        `/api/polls/${pollId}/results-stream/`,
      );

      eventSource.onmessage = function (event) {
        const results = JSON.parse(event.data).results;
        let resultsHTML = "<ul>";
        results.forEach((option) => {
          resultsHTML += `<li>${option.option_text}: ${option.vote_count} votes</li>`;
        });
        resultsHTML += "</ul>";
        resultsDiv.innerHTML = resultsHTML;
      };

      eventSource.onerror = function (error) {
        console.error("SSE error:", error);
        eventSource.close();
      };
    </script>
  </body>
</html>
